import streamlit as st
import google.generativeai as genai
from PIL import Image

# --- 1. æ ¸å¿ƒè³‡æ–™åº« (æ™é§’ï¼Œé€™éƒ¨åˆ†å…§å®¹ç²¾é¸è‡ªä½ æä¾›çš„ã€Šè²¡è³¦å¯†ç¢¼ã€‹) ---
HD_DATABASE = {
    "types": {
        "ç”Ÿç”¢è€…": "ã€å»ºç«‹è€…ã€‘é©åˆç©©å®šç”¢å‡ºã€‚è³ºéŒ¢å¯†ç¢¼ï¼šå°å·¥ä½œæœ‰ã€å›æ‡‰ã€æ™‚ç”¢èƒ½æœ€é«˜ã€‚",
        "é¡¯ç¤ºç”Ÿç”¢è€…": "ã€å¤šå·¥å»ºç«‹è€…ã€‘æ•ˆç‡æ¥µé«˜ã€‚è³ºéŒ¢å¯†ç¢¼ï¼šå…ˆæ±‚æœ‰å†æ±‚å¥½ã€‚",
        "æŠ•å°„è€…": "ã€æŒ‡å°è€…ã€‘é©åˆé¡§å•ã€ç®¡ç†ã€‚è³ºéŒ¢å¯†ç¢¼ï¼šç­‰å¾…æ­£å¼é‚€è«‹ï¼Œæ‰è¯è¢«çœ‹è¦‹æ™‚èº«åƒ¹æœ€é«˜ã€‚",
        "é¡¯ç¤ºè€…": "ã€ç™¼èµ·è€…ã€‘é©åˆé ˜å°ã€é–‹å‰µã€‚è³ºéŒ¢å¯†ç¢¼ï¼šè¡Œå‹•å‰ã€å‘ŠçŸ¥ã€ä»¥æ¸›å°‘é˜»åŠ›ã€‚",
        "åæ˜ è€…": "ã€è©•æ–·è€…ã€‘è§€å¯Ÿç¾¤é«”åƒ¹å€¼ã€‚è³ºéŒ¢å¯†ç¢¼ï¼šéš¨æœˆäº®é€±æœŸé‹ä½œã€‚"
    },
    "channels": {
        "10-20": "ã€è¦ºé†’ã€‘é©åˆï¼šç”Ÿå‘½å°å¸«ã€å…§å®¹å‰µä½œã€‚",
        "26-44": "ã€å‚³éè¨Šæ¯ã€‘é©åˆï¼šå»£å‘Šã€æ¥­å‹™é–‹ç™¼ã€‚",
        "21-45": "ã€é‡‘éŒ¢é€šé“ã€‘é©åˆï¼šçµ„ç¹”é ˜å°è€…ã€è²¡å‹™ç®¡ç†ã€‚"
    }
}

# --- 2. ä»‹é¢è¨­å®š ---
st.set_page_config(page_title="YG äººé¡åœ–è²¡è³¦å„€", layout="centered")
st.title("ğŸ’¡ äººé¡åœ–è²¡è³¦å¯†ç¢¼åˆ†æå„€")
st.write("æ‰¾åˆ°ä½ çš„è·å ´åŸå» è¨­å®šã€‚ä½œè€…ï¼šææ™é§’ (YG)")

# --- 3. æ‰‹å‹•è¼¸å…¥å€ (æœ€æ˜é¡¯çš„ä½ç½®) ---
st.markdown("---")
st.header("âœï¸ ç›´æ¥è¼¸å…¥ä½ çš„æ•¸æ“š")

# ä½¿ç”¨è¡¨å–®å…ƒä»¶è®“è¼¸å…¥æ›´æ•´é½Š
with st.form("my_form"):
    user_type = st.selectbox("1. é¸æ“‡ä½ çš„é¡å‹", ["è«‹é¸æ“‡"] + list(HD_DATABASE["types"].keys()))
    input_ch = st.text_input("2. è¼¸å…¥å·²æ¥é€šé€šé“ (ä¾‹å¦‚: 10-20, 26-44)", placeholder="å¤šçµ„è«‹ç”¨é€—è™Ÿéš”é–‹")
    input_gt = st.text_input("3. è¼¸å…¥æœ‰è‰²é–˜é–€ (ä¾‹å¦‚: 1, 21, 56)", placeholder="å¤šå€‹æ•¸å­—è«‹ç”¨é€—è™Ÿéš”é–‹")
    
    submit_button = st.form_submit_button(label="ğŸš€ ç”Ÿæˆæˆ‘çš„è²¡è³¦å ±å‘Š")

if submit_button:
    if user_type == "è«‹é¸æ“‡":
        st.error("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹ã€é¡å‹ã€å–”ï¼")
    else:
        st.balloons() # å¢åŠ ä¸€é»æˆå°±æ„Ÿçš„ç‰¹æ•ˆ
        st.subheader(f"ğŸ“Š {user_type} çš„å°ˆå±¬è²¡è³¦åˆ†æ")
        st.success(HD_DATABASE["types"][user_type])
        
        if input_ch:
            st.markdown("#### ğŸ› ï¸ æ ¸å¿ƒæ‰èƒ½")
            for ch in [c.strip() for c in input_ch.split(",")]:
                st.write(f"âœ… **{ch} é€šé“**ï¼š{HD_DATABASE['channels'].get(ch, 'å…§å®¹è£œå……ä¸­...')}")

# --- 4. AI è¾¨è­˜å€ (æ”¾åœ¨æœ€å¾Œé¢ç•¶å‚™æ¡ˆ) ---
st.markdown("---")
st.header("ğŸ“¸ æ²’æ•¸æ“šï¼Ÿä¸Šå‚³æˆªåœ–è¾¨è­˜")
uploaded_file = st.file_uploader("é»æ“Šä¸Šå‚³äººé¡åœ–æˆªåœ–", type=["png", "jpg", "jpeg"])

if uploaded_file:
    if "GOOGLE_API_KEY" in st.secrets:
        genai.configure(api_key=st.secrets["GOOGLE_API_KEY"])
        img = Image.open(uploaded_file)
        st.image(img, width=200)
        if st.button("é–‹å§‹ AI æƒæ"):
            model = genai.GenerativeModel('gemini-1.5-pro')
            res = model.generate_content(["è«‹è­˜åˆ¥é€™å¼µäººé¡åœ–çš„é¡å‹ã€é€šé“èˆ‡é–˜é–€ã€‚ç”¨ç¹é«”ä¸­æ–‡å›ç­”ã€‚", img])
            st.info(res.text)
    else:
        st.warning("âš ï¸ API Key å°šæœªè¨­å®šï¼Œç„¡æ³•ä½¿ç”¨è‡ªå‹•è¾¨è­˜ï¼Œè«‹ä½¿ç”¨ä¸Šæ–¹çš„ã€æ‰‹å‹•è¼¸å…¥ã€ã€‚")
